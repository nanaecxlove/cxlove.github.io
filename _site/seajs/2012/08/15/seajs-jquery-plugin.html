
﻿<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>【转】jQuery 模块介绍与 jQuery 插件的深度模块化-cxlove's blog</title>
    <meta name="generator" content="cxlove" />
    <meta name="keywords" content="cxlove,ACM-ICPC,algorithm" />
    <meta name="description" content="我们可以通过简单封装，让 jQuery 与jQuery的插件 成为 seajs 的模块。这样，调用时只要 require 即可。转自玉伯 【jQuery 模块介绍与 jQuery 插件的深度模块化】,方便不能翻墙的同学查看。">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/js/code/prettify.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">

          <div class="violet-logo">
                <div class="v-position-1">
                    <div class="v-petal v-deg-0 v-color-1">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-2">
                    <div class="v-petal v-deg-60 v-color-2">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-3">
                    <div class="v-petal v-deg-120 v-color-3">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-4">
                    <div class="v-petal v-deg-180 v-color-4">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-5">
                    <div class="v-petal v-deg-240 v-color-5">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-6">
                    <div class="v-petal v-deg-300 v-color-6">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
            </div><!-- //violet-logo -->

          <a class="brand" href="/">cxlove</a><!--  -->
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/index.html">Index</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>【转】jQuery 模块介绍与 jQuery 插件的深度模块化 <small>Supporting tagline</small></h1>
</div>

<div class="row">
  <div class="span8">
    <div class="v-entry">
<p>转自玉伯 <a href="http://lifesinger.wordpress.com/2011/08/19/jquery-introduction-and-plugins-modulization/">jQuery 模块介绍与 jQuery 插件的深度模块化</a>,方便不能翻墙的同学查看。
##jQuery模块
大名鼎鼎的 jQuery 就不多介绍了，详细介绍推荐官网：jquery.com
阮一峰最近整理的文章也不错，推荐：<a href="http://www.ruanyifeng.com/blog/2011/07/jquery_fundamentals.html">jQuery 设计思想</a>, <a href="http://www.ruanyifeng.com/blog/2011/08/jquery_best_practices.html">jQuery 最佳实践</a></p>

<p>几点感悟：</p>

<ol>
  <li>jQuery 是 DOM 操作类库，其核心功能是找到 DOM 元素并对其进行操作。</li>
  <li>拿 jQuery 与 YUI, Dojo 等框架相比是不公平的，就如拿轮胎和汽车相比一样。jQuery 只是一个轮胎，功能很单一，YUI 和 Dojo 等则是相对完整的汽车，除了轮胎，还有引擎、外壳等等。</li>
  <li>说 jQuery 不适合构建大型应用，就如说轮胎不适合参加赛车比赛一样不合逻辑。你可以用 jQuery 做轮胎，然后选择其他部件组合起来去 DIY 一辆赛车。能否胜出，得看赛车手的 DIY 水准。</li>
  <li>jQuery的困局在于 DIY 高手不多，经常是一个好轮胎挂上一堆破破烂烂的外壳就上前线了。jQuery 的破局也在于 DIY. DIY 意味着灵活、可替换性，意味着可快速前行和高性能。</li>
  <li>jQuery 灵活性带来的缺陷，比如有可能由选择器和链式风格导致的低效 DOM 操作，目前在提供了同类功能的 YUI3 等类库中同样存在。这不是类库的问题，更多是因为使用者的经验欠缺导致的。就如一把优秀的菜刀，到了一个拙劣的厨子手中，依旧切不好菜一样。工具很重要，但更重要的是我们得提升自己的刀工。</li>
  <li>最后，回到第一点：jQuery 是 DOM 操作类库。非 DOM 操作，都是 jQuery 的辅助功能，不是 jQuery 的强项，就如菜刀不能当斧头用一样。</li>
</ol>

<p>我们可以通过简单封装，让 jQuery 成为 CommonJS 的模块。这样，调用时只要 require 即可：</p>

<p>test.html:</p>

<pre><code>&lt;script src="http://modules.seajs.com/libs/seajs/1.0.1/sea.js"&gt;&lt;/script&gt;
&lt;script&gt;
seajs.use('./init');
&lt;/script&gt;
</code></pre>

<p>init.js:</p>

<pre><code>seajs.config({
  alias: {
    'juery': 'jquery/1.6.1/jquery'
  }
});

define(function(require, exports, module) {
  var $ = require('jquery');
  // do something with jQuery
});
</code></pre>

<h2 id="jquery">jQuery插件的模块化</h2>
<p>jQuery 提供了 DOM 操作功能，在实际应用中，我们还需要 cookie, template, storage 等等一系列功能。这时可以从 jQuery 社区中寻找各种插件来完成。大部分插件通过 jQuery 插件的模块化 一文中提供的方法封装就好。</p>

<p>之前的封装方法，总结成一句话是：“jQuery 穿肠过，插件身上留”。正如 Kidwind 反馈的一样，每次“穿肠过”的时候都要运行一次插件代码，频繁调用某些插件时，会存在 CPU 浪费，还可能带来隐患：</p>

<blockquote>
  <p>假设有以下jquery插件a, b, c, d，它们之间的关系如下</p>

  <ul>
    <li>b 依赖于 a</li>
    <li>c 依赖于 a</li>
    <li>d 依赖于 b c</li>
  </ul>
</blockquote>

<blockquote>
  <p>假设页面使用到d插件，那么插件a将进行两次初始化，也就是会调用两次
<code>var $ = require('jquery');require('a')($);</code>
进行插件a的注册，当系统复杂时，重复的插件注册会不会影响系统的性能，同时会不会存在隐患？如插件b对引用的插件a进行了部分功能扩展，当引入插件c的时候又重新注册了插件a，那么插件b对插件a的扩展将不存在了，当然改写插件功能的实际情况也许不会存在，此处只是举个例子，说明隐患的存在。
如何避免重复的插件注册，可以避免隐患，同时获得更好的性能（避免了多次插件注册的运算耗时）。</p>
</blockquote>

<p>面对这种情况，我们究竟应该如何做好 jQuery 插件的模块化？</p>

<p>jQuery 插件的形式</p>

<p>jQuery 插件一般可以总结为以下模板：</p>

<pre><code>(function($) {  
  // Main plugin function
  $.fn.PLUGIN = function(options) {
    // snip...
  };

  // Public plugin function
  $.fn.PLUGIN.FUNCT = function() {
    // Cool JS action
  };

  // Default settings for the plugin
  $.fn.PLUGIN.defaults = { /* snip... */ };

  // Private function that is used within the plugin
  // snip...
})(jQuery);
</code></pre>

<p>简言之就是往 <code>$.fn</code> 上添加新成员，有部分插件还会往 <code>$</code> 上添加成员。</p>

<p>之前的“穿肠过”模块化方式，可以表示为：</p>

<pre><code>define(function() { return function($) {
  $.fn.PLUGIN = ...
}});
</code></pre>

<p>调用方式：</p>

<pre><code>define(function(require, exports) {
  var $ = require('jquery');
  require('some-jquery-plugin')($);

  $(sth).PLUGIN(...);
}); 不是很直观，不够方便，还有前面提到的隐患。
</code></pre>

<p>深度模块化</p>

<p>为了更好的模块化，意味着我们要添加更多代码：</p>

<pre><code>define(function(require, exports, module) {
  var $ = require('jquery').sub();

  // Main plugin function
  $.fn.PLUGIN = function(options) {
    // snip...
  };

  // Public plugin function
  $.fn.PLUGIN.FUNCT = function() {
    // Cool JS action
  };

  // Default settings for the plugin
  $.fn.PLUGIN.defaults = { /* snip... */ };

  // Private function that is used within the plugin
  // snip...

  module.exports = $;
}); 这样封装后，调用变成：

define(function(require, exports) {
  var $ = require('jquery');
  var PLUGIN = require('some-jquery-plugin');
  PLUGIN(sth).PLUGIN(...);
}); 这样能解决之前提到的重复初始化问题，但是 `PLUGIN(sth).PLUGIN(…)` 的使用方式怪怪的。比如这个非常帅的 chosen 插件，按照上面的方式模块化后，调用方式为：

chosen('#some-id').chosen(); 虽然可用，但怎么看怎么别扭。这是因为 jQuery 是以 DOM 为中心的，代码的默认流程是找到要操作的 DOM 元素，然后对其进行操作。这种代码书写方式，对于模块后的插件来说，很别扭。更好的期待中的调用方式是：

define(function(require, exports) {
  var $ = require('jquery');
  var Chosen = require('chosen');
 
  var chosen = new Chosen(selector, options);
  chosen.doSth(...);
}); 理论上，我们甚至可以不知道 chosen 依赖 jQuery, 我们需要关心的只是 chosen 的 API. 上面这种理想的调用方式，需要我们对插件进行“深度”模块化：
</code></pre>

<p>some-jquery-plugin.js:</p>

<pre><code>define(function(require, exports, module) {
  var $ = require('jquery');

  // Main plugin function
  function PLUGIN(selector, options) {
    var els = $(selector);
    // snip...
  };

  // Public plugin function
  PLUGIN.FUNCT = function() {
    // Cool JS action
  };

  // Default settings for the plugin
  PLUGIN.defaults = { /* snip... */ };

  // Private function that is used within the plugin
  // snip...

  module.exports = PLUGIN;
}); 也就是说，在 plugin 的代码里，我们并不对 $.fn 或 $ 进行扩展，只用 $ 来进行 DOM 操作而已，返回的是独立的 PLUGIN 对象，就和我们写普通的业务模块一样。这样，就实现预期中更优雅的调用方式。
</code></pre>

<p>jQuery 的插件机制，在模块化面前很鸡肋。jQuery 一直被冠以“不适合大型项目”，也和 jQuery 的这种插件机制有关系。这会导致大家都去污染 $.fn, 这就和污染全局变量一样。项目一大，冲突的概率，和调试的成本都会变大，很悲剧。</p>

<p>因此，推荐大家利用模块的机制去重构一部分好用的 jQuery 插件，目前 dew 项目里已经重新实现了 cookie 等部分模块。强烈推荐大家都参与进来，将自己喜欢的，常用的 jQuery 等插件迁移过来。或者推进插件作者直接修改源码，增加对 CommonJS 的支持。路漫漫，但众人拾柴火焰高，星火可燎原，期待大家的参与。</p>

<p>建议大家直接 fork dew 项目，可以将自己重构的模块 pull request 过来，邮件给 seajs(at)googlegroups.com 群组。讨论和 code review 后，就可以转成 dew 的正式模块。</p>

<p>等模块丰富起来，我们就可以有更多时间去做更意思的事情了。</p>
</div>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/seajs/2012/08/14/seajs-combat.html" title="seajs实战参考">&larr; Previous</a></li>
      
        <li><a href="">Archive</a></li>
      
        <li class="next"><a href="/seajs/2012/08/26/seajs-require-theory.html" title="seajs模块依赖的加载处理">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>15 August 2012</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="#jquery-ref">jquery <span>2</span></a></li>
     
    	<li><a href="#jqueryPlugin-ref">jqueryPlugin <span>2</span></a></li>
     
    	<li><a href="#seajs-ref">seajs <span>4</span></a></li>
     
    	<li><a href="#模块化-ref">模块化 <span>3</span></a></li>
     
    	<li><a href="#代码组织-ref">代码组织 <span>3</span></a></li>
     
    	<li><a href="#性能优化-ref">性能优化 <span>3</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy;  2014 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->
    <a class="v-fork-me" href="https://github.com/cxlove/cxlove.github.io" target="_blank" rel="nofollow">
        <img src="/assets/themes/twitter/img/forkme.png" alt="Fork me on GitHub">
    </a>

    <!--

-->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0a2402a2f6f786cb7b8aa7466136e44e' type='text/javascript'%3E%3C/script%3E"));
</script>

    <script type="text/javascript" src="/assets/themes/twitter/js/code/prettify.js"></script>
    <script type="text/javascript" src="/assets/themes/twitter/js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript">
        $(function(){
          $("pre").addClass("prettyprint");//linenums 数字
          prettyPrint();
          $('.v-entry a').each(function(){
            if($(this).attr("href").indexOf("cxlove") == -1){
              $(this).attr("target", "_blank");
            }
          })
        });
      </script>
  </body>
</html>

