
﻿<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>seajs实战参考-cxlove's blog</title>
    <meta name="generator" content="cxlove" />
    <meta name="keywords" content="cxlove,ACM-ICPC,algorithm" />
    <meta name="description" content="该页面列举了 SeaJS 中的常用实战过程中的问题，如全局接口，时间戳管理等实战性问题。只要掌握这些方法，就可以娴熟地开始对你的网站进行模块化开发了。">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/js/code/prettify.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Update these with your own images
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">

          <div class="violet-logo">
                <div class="v-position-1">
                    <div class="v-petal v-deg-0 v-color-1">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-2">
                    <div class="v-petal v-deg-60 v-color-2">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-3">
                    <div class="v-petal v-deg-120 v-color-3">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-4">
                    <div class="v-petal v-deg-180 v-color-4">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-5">
                    <div class="v-petal v-deg-240 v-color-5">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
                <div class="v-position-6">
                    <div class="v-petal v-deg-300 v-color-6">
                        <div class="v-petal-top">
                        </div>
                        <div class="v-petal-left">
                            <div class="v-petal-left-det">
                            </div>
                        </div>
                        <div class="v-petal-right">
                            <div class="v-petal-right-det">
                            </div>
                        </div>
                    </div><!-- v-petal -->
                </div>
            </div><!-- //violet-logo -->

          <a class="brand" href="/">cxlove</a><!--  -->
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/index.html">Index</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        
<div class="page-header">
  <h1>seajs实战参考 <small>Supporting tagline</small></h1>
</div>

<div class="row">
  <div class="span8">
    <div class="v-entry">
<h2 id="seajs">seajs实战参考</h2>
<p>该页面列举了 SeaJS 中的常用实战过程中的问题。只要掌握这些方法，就可以娴熟地开始对你的网站进行模块化开发了。</p>

<p>默认情况下，SeaJS 要求所有文件都是标准的 CMD 模块，但现实场景下，有大量 jQuery 插件等非 CMD 模块存在。在 SeaJS 里，通过以下方式，可以直接调用非标准模块。</p>

<h3 id="js">全站通用的要加载的库只写一次，而不想每个js里都调用，太繁琐</h3>
<pre><code>//可以放在在 init.js 里暴露到全局，这样，所有在 init.js 之后载入的文件，就都可以直接通过全局变量来拿 $ 等对象。

seajs.use('init')

//init.js
define(function(require, exports) {
	var $ = jQuery = require('jquery');
	
	// 暴露到全局
  		window.$ = $;
});
</code></pre>

<h3 id="jquery">1. 暴露 jQuery</h3>
<p>jQuery 插件都依赖 jQuery 模块，为了加载 jQuery 插件，首先得将 jQuery 模块暴露出来：</p>

<pre><code>// 配置 jquery 并放入预加载项中
seajs.config({
  alias: {
    'jquery': 'https://a.alipayobjects.com/static/arale/jquery/1.7.2/jquery.js'
  },
  preload: ["jquery"]
})

// 将 jQuery 暴露到全局
seajs.modify('jquery', function(require, exports) {
  window.jQuery = window.$ = exports
})
</code></pre>

<h3 id="jquery-">2. 修改 jQuery 插件的接口</h3>
<p>我们以 jquery.cookie 插件为例。</p>

<pre><code>// 配置别名
seajs.config({
  alias: {
    'cookie': 'https://raw.github.com/carhartl/jquery-cookie/master/jquery.cookie.js'
  }
})

// 将 jQuery Cookie 插件自动包装成 CMD 接口
seajs.modify('cookie', function(require, exports, module) {
  module.exports = $.cookie
})
</code></pre>

<h3 id="cookie-">3. 调用 Cookie 插件</h3>
<p>这样，在其他模块中，就可以直接调用 cookie 插件了：</p>

<pre><code>a.js:

define(function(require, exports) {
  var cookie = require('cookie')

  cookie('the_cookie')
  cookie('the_cookie', 'the_value')

  // ...
}) 完整范例：[http://seajs.org/test/issues/auto-transport/test.html](http://seajs.org/test/issues/auto-transport/test.html)
</code></pre>

<h2 id="seajs-1">seajs里版本号和时间戳问题</h2>
<p>用 seajs 组织项目，上线后，经常需要更新特定文件或所有文件的时间戳，以清空浏览器缓存。最简单的方式是：</p>

<pre><code>//用来维护 jquery 等类库模块的版本号
seajs.config({
  alias: {
    'jquery': 'jquery/1.6.2/jquery',
    'backbone': 'backbone/0.5.1/backbone',
    'a': 'a.js?20110801',
    'b': 'b.js?20110801'
  }
});	

//利用 map,批量更新时间戳是最方便的
seajs.config({
  'map': [
    [ /^(.*\.(?:css|js))(.*)$/i, '$1?20110801' ]
  ]
});	
</code></pre>

<h2 id="section">条件加载</h2>

<p>第一种：把依赖的模块都在 define 头部手工声明，不再依赖 SeaJS 的自动解析功能。这个模块同时依赖 play 和 work 两个模块，加载器会把这两个模块文件都下载下来。如果需要在 require 模块之后串行执行代码，那么只能用这个方式。</p>

<pre><code>define(['play', 'work'], function(require, exports) {
	 //是出去玩，还是工作？
    var choice = require(condition() ? 'play' : 'work');
	//选择的难度
    console.log(choice.hard());
});
</code></pre>

<p>第二种：使用 require.async 来进行条件加载，从静态分析的角度来看，require.async适合需要执行动态加载的模块很大（比如大量 json 数据），不适合都下载下来。但是require.async 方式加载的模块，不能打包工具找到，自然也不能被打包进上线的 js 中；而前一种方式可以。</p>

<pre><code>define(function(require, exports) {
    require.async(condition() ? 'play' : 'work', function(choice) {
        console.log(choice.hard());
    });
});
</code></pre>

<h2 id="section-1">按需加载</h2>
<p>很多时候模块并不需要立即加载，等到需要时再加载，性能更好。</p>

<pre><code>//init.js
$("#J_PicCover").click(function(){
	require.async('module/highlight', function(){
		$(".buy-info").highlight({color:'#ffe5c4',speed:500,complete:function(){
		},iterator:'sinusoidal'});
	});
});

//highlight.js
define(function(require, exports) {
	jQuery.fn.highlight = function(settings) {
		//…...
	}
});
</code></pre>
</div>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/seajs/2012/08/13/seajs-cheet-sheet.html" title="seajs快速参考">&larr; Previous</a></li>
      
        <li><a href="">Archive</a></li>
      
        <li class="next"><a href="/seajs/2012/08/15/seajs-jquery-plugin.html" title="【转】jQuery 模块介绍与 jQuery 插件的深度模块化">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>14 August 2012</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="#seajs-ref">seajs <span>4</span></a></li>
     
    	<li><a href="#模块化-ref">模块化 <span>3</span></a></li>
     
    	<li><a href="#代码组织-ref">代码组织 <span>3</span></a></li>
     
    	<li><a href="#性能优化-ref">性能优化 <span>3</span></a></li>
     
    	<li><a href="#实战经验-ref">实战经验 <span>1</span></a></li>
    
  



    </ul>
    
  </div>
</div>


      </div>

      <footer>
        <p>&copy;  2014 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->
    <a class="v-fork-me" href="https://github.com/cxlove/cxlove.github.io" target="_blank" rel="nofollow">
        <img src="/assets/themes/twitter/img/forkme.png" alt="Fork me on GitHub">
    </a>

    <!--

-->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0a2402a2f6f786cb7b8aa7466136e44e' type='text/javascript'%3E%3C/script%3E"));
</script>

    <script type="text/javascript" src="/assets/themes/twitter/js/code/prettify.js"></script>
    <script type="text/javascript" src="/assets/themes/twitter/js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript">
        $(function(){
          $("pre").addClass("prettyprint");//linenums 数字
          prettyPrint();
          $('.v-entry a').each(function(){
            if($(this).attr("href").indexOf("cxlove") == -1){
              $(this).attr("target", "_blank");
            }
          })
        });
      </script>
  </body>
</html>

